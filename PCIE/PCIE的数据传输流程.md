# PCIE的数据传输流程
在数据传输的时候，PCIE协议传输数据是以数据包的形式传输。

首先在**发送端**，设备核或者应用软件产生数据信息，交由**PCI Express Core Logic Interface**将数据格式转换**TL**(Transaction Layer)层可以接受的格式，**TL层**产生相应的数据包，然后数据包被存储在缓冲buffer中，准备传输给下一层**数据链路层**(Data Link Layer)。**数据链层**将上一层传来的数据包添加一些额外的数据用来给接收端进行一些必要的数据正确性检查。然后**物理层**将数据包编码，通过多条链路使用模拟信号进行传输。

在**接收端**，接收端设备在**物理层**解码传输的数据，并将数据传输至上一层**数据链层**，**数据链层**将入站数据包进行正确性检查，如果没有错误就将数据传输至**TL**层，**TL层**将数据包缓冲buffer，之后**PCI Express Core Logic Interface**将数据包转换成设备核或者软件能够处理的数据。
![PCIE数据包的处理](./image/pcie%E6%95%B0%E6%8D%AE%E5%8C%85%E7%9A%84%E5%A4%84%E7%90%86%E8%BF%87%E7%A8%8B.png "PCIE数据包的处理")

>在TLP包传输的过程中会发生数据包的组装和拆解。
## TLP包的组装
- 当数据从软件层或者设备核传来之后，TL层添加ECRC。
- 在DLL层在前段添加序列数字，在后面添加DLL层的CRC。
- 在物理层添加帧头和帧末。
![TLP组包](./image/TLP%E7%BB%84%E5%8C%85.png "TLP组包")

## TLP包的拆解
TLP的拆解是一个反过程，如下图所示：
![TLP拆包](./image/TLP%E6%8B%86%E5%8C%85.png "TLP拆包")



